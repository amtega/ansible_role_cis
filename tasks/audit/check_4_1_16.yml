---

- name: Setup fact with check description
  set_fact:
    cis_check_description: >-
      Ensure system administrator actions (sudolog) are collected

- name: Gather data from audit.rules
  command: >-
    /usr/bin/grep actions /etc/audit/audit.rules
  changed_when: no
  failed_when: no
  register: cis_gather_data_audit_rules_result

- name: Gather data from auditctl
  command: >-
    /usr/sbin/auditctl -l
  changed_when: no
  failed_when: no
  register: cis_gather_data_auditctl_result

- name: "{{ cis_check_description }}"
  vars:
    desired_output: "-w /var/log/sudo.log -p wa -k actions"
  assert:
    quiet: "{{ cis_quiet_assertions }}"
    that:
      - "cis_gather_data_audit_rules_result.stdout | length > 0"
      - "cis_gather_data_auditctl_result.stdout | length > 0"
      - "desired_output in cis_gather_data_audit_rules_result.stdout"
      - "desired_output in cis_gather_data_auditctl_result.stdout"
  register: cis_check_result
  no_log: "{{ cis_no_log }}"
